# 智能体详细说明

## 概述

本项目包含6个智能体，分为两个层级：功能执行层（4个核心智能体）和支持服务层（2个辅助智能体）。这些智能体协同工作，实现污水微生物净化技术的全流程自动化开发。

## 功能执行层智能体

### 1. 工程微生物组识别智能体 (EngineeringMicroorganismIdentificationAgent)

**文件**: `agents/engineering_microorganism_identification_agent.py`

**角色**: 功能微生物组识别专家

**目标**: 根据水质净化目标筛选功能微生物和代谢互补微生物

**核心功能**:
- 从数据库获取领域知识以识别最适合的工程微生物
- 使用专门的数据查询工具查询所有相关数据
- 基于微调大语言模型，按"互补指数＞竞争指数"筛选功能微生物
- 重点关注微生物对目标污染物的降解能力和代谢途径

**工具使用**:
- PollutantDataQueryTool: 查询污染物数据
- GeneDataQueryTool: 查询基因数据
- OrganismDataQueryTool: 查询微生物数据
- PollutantSummaryTool: 获取污染物摘要信息
- PollutantSearchTool: 搜索污染物

**工作流程**:
1. 接收用户输入的水质净化目标
2. 识别目标污染物
3. 查询相关基因和微生物数据
4. 分析微生物的降解能力和代谢途径
5. 筛选功能微生物和代谢互补微生物
6. 提供完整的微生物组推荐方案

### 2. 微生物菌剂设计智能体 (MicrobialAgentDesignAgent)

**文件**: `agents/microbial_agent_design_agent.py`

**角色**: 微生物菌剂设计专家

**目标**: 根据水质净化目标和工程微生物组设计高性能微生物菌剂

**核心功能**:
- 分析工程微生物组提供的功能微生物和代谢互补微生物
- 遍历微生物组合，形成多个候选菌剂群落
- 使用ctFBA（协同权衡代谢通量平衡法），以目标污染物为唯一碳源，计算各候选群落的代谢通量（F_take）
- 根据代谢通量和群落稳定性选择最优菌剂

**工具使用**:
- PollutantDataQueryTool: 查询污染物数据
- GeneDataQueryTool: 查询基因数据
- OrganismDataQueryTool: 查询微生物数据
- PollutantSummaryTool: 获取污染物摘要信息
- PollutantSearchTool: 搜索污染物

**设计原则**:
- 优先保证菌剂对目标污染物的降解能力
- 确保菌剂群落的稳定性和鲁棒性
- 考虑微生物间的协同作用和代谢互补性
- 优化菌剂配比以实现最佳净化效果

### 3. 菌剂评估智能体 (MicrobialAgentEvaluationAgent)

**文件**: `agents/microbial_agent_evaluation_agent.py`

**角色**: 菌剂评估专家

**目标**: 评估微生物菌剂的生物净化效果和生态特性

**核心功能**:
- 评估微生物菌剂的净化效果和生态特性
- 根据微生物菌剂、水质净化目标（含生态预期值）、污水厂水质背景进行综合评估

**评估维度**:
1. 生物净化效果：
   - 降解速率：Degradation_rate=F_take×X（X=菌剂投加量）
   - 达标判断：根据水质目标判断是否满足要求
2. 群落生态特性（核心标准）：
   - 群落稳定性：Pianka生态位重叠指数（互补度C=1-O，C越高越稳）
   - 结构稳定性：物种敲除指数（I_KO越近1越稳）、通路阻断恢复能力

**工具使用**:
- EvaluationTool: 评估菌剂效果和生态特性

**决策规则**:
- 群落稳定性和结构稳定性是必须达标的两个核心标准
- 如果任一核心标准不达标，整个菌剂方案需要重新设计
- 使用EvaluationTool工具来判断核心标准是否达标

### 4. 实施方案生成智能体 (ImplementationPlanGenerationAgent)

**文件**: `agents/implementation_plan_generation_agent.py`

**角色**: 实施方案生成专家

**目标**: 根据微生物菌剂、评估报告生成完整的微生物净化技术落地方案

**核心功能**:
- 生成可在目标污水厂应用的高效降解菌剂及完整方案
- 基于微生物菌剂设计方案
- 参考菌剂评估报告的结论和建议
- 结合目标污水厂的实际条件和需求

**方案内容**:
1. 菌剂获取：
   - 合法渠道（CGMCC/ATCC采购、实验室分离、合作授权）
   - 菌剂组成和特性说明
2. 制剂储运：
   - 液体浓缩剂（10⁹ CFU/mL，2-8℃存1-3月）
   - 冻干粉（10¹⁰ CFU/g，常温存6-12月）
   - 储存和运输条件要求
3. 投加策略：
   - 启动期分阶段投加方案
   - 稳定期定期投加计划
   - 应急补投措施
4. 监测应急：
   - 周期性水质和微生物群落监测计划
   - 异常情况下的参数调整方案
   - 应急处理措施

## 支持服务层智能体

### 5. 知识管理智能体 (KnowledgeManagementAgent)

**文件**: `agents/knowledge_management_agent.py`

**角色**: 知识管理专家

**目标**: 确定与生物净化任务相关的领域知识，并补充知识数据库中未包含的代谢模型

**核心职责**:
1. 领域知识提供：
   - 为其他智能体提供水质治理、污染物特性、微生物代谢途径等相关领域的背景知识
   - 解释专业术语和概念，确保各智能体对任务有统一的理解
2. 数据库补充：
   - 识别当前知识库中的不足
   - 补充必要的代谢模型和领域知识
3. 工具协调：
   - 协助其他智能体正确使用专门的数据查询工具
   - 指导使用EnviPath和KEGG等外部数据库工具

**工具使用**:
- PollutantDataQueryTool: 查询污染物数据
- GeneDataQueryTool: 查询基因数据
- OrganismDataQueryTool: 查询微生物数据
- PollutantSummaryTool: 获取污染物摘要信息
- PollutantSearchTool: 搜索污染物

### 6. 任务协调智能体 (TaskCoordinationAgent)

**文件**: `agents/task_coordination_agent.py`

**角色**: 任务协调专家

**目标**: 根据任务执行情况和评估结果，智能地决定下一步应该执行哪个智能体，实现自主任务调度

**核心功能**:
- 调控生物净化技术开发智能体、技术评估智能体、技术方案生成智能体的执行顺序
- 在分层处理模式（Process.hierarchical）中，作为管理者，根据任务执行情况和评估结果决定下一步应该执行哪个智能体

**工作流程**:
1. 如果是初始状态，应该启动微生物识别任务
2. 如果微生物识别已完成，应该启动菌剂设计任务
3. 如果菌剂设计已完成，应该启动评估任务
4. 如果评估结果不达标，应该重新启动微生物识别任务
5. 如果评估结果达标，应该启动方案生成任务

**工具使用**: 无专用工具

## 智能体协作模式

系统支持两种任务处理模式：

### 1. 链式处理模式 (Process.sequential)
- 按固定顺序执行智能体
- 适合流程明确、任务依赖关系简单的场景

### 2. 自主选择模式 (Process.hierarchical)
- 智能体根据任务执行情况和评估结果自主选择下一步要执行的智能体
- 任务协调智能体作为管理者进行动态任务调度
- 适合复杂场景，能够实现更灵活的任务调度和反馈闭环